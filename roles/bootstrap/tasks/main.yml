---
# tasks file for ansible-role-bootstrap
- name: register release
  raw: cat /etc/*-release
  register: release
  changed_when: false
  become: no

- name: install python and sudo on alpine
  raw: apk update ; apk add python sudo
  when:
    - "'alpine' in release.stdout"
  register: alpine
  changed_when:
    - "'Installing python' in alpine.stdout"
  remote_user: "{{ remoteuser }}"

- name: install python2 and sudo on centos
  raw: yum -y install python2 sudo
  when:
    - "'CentOS' in release.stdout"
  register: centos
  changed_when:
    - "'Nothing' not in centos.stdout"
  remote_user: "{{ remoteuser }}"

- name: install python and sudo on debian
  raw: apt-get update ; apt-get -y install python sudo
  when:
    - "'Debian' in release.stdout"
  register: debian
  changed_when:
    - "' 0 newly installed' not in debian.stdout"
  remote_user: "{{ remoteuser }}"

- name: install python2, python2-dnf and sudo on fedora
  raw: yum -y install python2 python2-dnf sudo
  when:
    - "'Fedora' in release.stdout"
  register: fedora
  changed_when:
    - "'Nothing' not in fedora.stdout"
  remote_user: "{{ remoteuser }}"

- name: install python, python-xml and sudo on opensuse
  raw: zypper -n install python python-xml sudo
  when:
    - "'openSUSE' in release.stdout"
  register: opensuse
  changed_when:
    - "'Nothing' not in opensuse.stdout"
  remote_user: "{{ remoteuser }}"
  failed_when: no

- name: install python2 and sudo on red hat
  raw: yum -y install python2 sudo
  when:
    - "'Red Hat' in release.stdout"
  register: python2redhat
  changed_when:
    - "'Nothing' not in python2redhat.stdout"
  remote_user: "{{ remoteuser }}"

- name: install python and sudo on ubuntu
  raw: apt-get update ; apt-get -y install python sudo
  when:
    - "'Ubuntu' in release.stdout"
  register: pythonubuntu
  changed_when:
    - "' 0 newly installed' not in pythonubuntu.stdout"
  remote_user: "{{ remoteuser }}"

- name: gather facts
  setup:
  become: no

- name: include distribution specific variables
  include_vars: "{{ item }}"
  with_first_found:
    - "{{ ansible_distribution }}-{{ ansible_distribution_major_version}}.yml"
    - "{{ ansible_distribution }}.yml"
    - "default.yml"

- name: install extra software
  package:
    name: "{{ item }}"
    state: present
  with_items: "{{ packages }}"
